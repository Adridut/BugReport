<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bug Report</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>



<div class="overlay">

    <h2>Bug Report</h2>

    <form>
        <div>
            <p class="row">Title: </p>
            <div class="row rightElement">
                <input  type="text" id="bug_title" name="bug_title" placeholder="Bug title">
            </div>
        </div>
        <hr>
        <div>
            <p class="row">Reporter: </p>
            <div class="row rightElement">
                <input type="text" id="reporter" name="reporter" placeholder="Reporter">
            </div>
        </div>
        <hr>
        <div>
            <p class="row">Date: </p>
            <input class="row rightElement" type="text" id="submit_date" name="submit_date" placeholder="Submit Date">
        </div>
        <hr>
        <div>
            <p class="row">Summary: </p>
            <input class="row rightElement" type="text" id="summary" name="summary" placeholder="Summary">
        </div>
        <hr>
        <div>
            <p class="row">URL: </p>
            <input class="row rightElement" type="url" id="url" name="url" placeholder="URL">
        </div>
        <hr>
        <div>
            <p class="row">Screenshot: </p>
            <input class="row rightElement" type="file" id="screenshot" name="screenshot">
        </div>
        <hr>
        <div>
            <p class="row">Browser: </p>
            <input class="row rightElement" type="text" id="browser" name="browser" placeholder="Browser">
        </div>
        <hr>
        <div>
            <p>Priority: </p>
            <div class="row rightElement">
                <input type="radio" id="low" name="priority">
                <label for="low">Low</label><br>
                <input type="radio" id="medium" name="priority">
                <label for="medium">Medium</label><br>
                <input type="radio" id="high" name="priority">
                <label for="high">High</label>
            </div>
        </div>
        <hr>
        <div>
            <p class="row">Description: </p>
            <input class="row rightElement" type="text" id="description" name="description" placeholder="Description">
        </div>
        <hr>
        <button type="submit" id="submit">Post</button>

    </form>
</div>

<script>

    let screenshot;

    document.getElementById('screenshot').addEventListener('change', (event) => {
        img = '';
        status.textContent = '';
        const file = event.target.files[0];
        if (!file.type) {
            status.textContent = 'Error: The File.type property does not appear to be supported on this browser.';
            return;
        }
        if (!file.type.match('image.*')) {
            status.textContent = 'Error: The selected file does not appear to be an image.';
            return;
        }
        const reader = new FileReader();
        reader.addEventListener('load', event => {
            img = event.target.result;
            screenshot = img;
        });
        reader.readAsDataURL(file);
    });


    const getData = () => {

        let priority;
        if (document.getElementById('medium').checked) {
            priority = "Medium"
        } else if (document.getElementById('high').checked) {
            priority = "High"
        } else {
            priority = "Low"
        }

        const data = {
            bug_title: document.getElementById('bug_title').value,
            reporter: document.getElementById('reporter').value,
            submit_date: document.getElementById('submit_date').value,
            summary: document.getElementById('summary').value,
            url: document.getElementById('url').value,
            screenshot: screenshot,
            browser: document.getElementById('browser').value,
            priority: priority,
            description: document.getElementById('description').value
        };

        return data;

    };

    const sendMail = (data) => {

        let url = "mailto:support@bugjack.com?Subject=Bug Report" + "&Body=Bug Report:%0A%0A"
            + "Bug title: " + data.bug_title + "%0A"
            + "Reporter: " + data.reporter + "%0A"
            + "Submit date: " + data.submit_date + "%0A"
            + "Summary: " + data.summary + "%0A"
            + "URL: " + data.url + "%0A"
            + "Browser: " + data.browser + "%0A"
            + "Priority: " + data.priority + "%0A"
            + "Description: " + data.description + "%0A";

        window.open(url);

    };


    let submit_button = document.getElementById('submit');
    submit_button.addEventListener('click', () => {

        let data = getData();

        sendMail(data);

        let url = 'https://hoermann-digital.firebaseio.com/bugs.json';


        const request = new Request(url, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: new Headers({
                'Content-Type': 'application/json'
            })
        });

        fetch(request)
            .then(res => res.json())
            .then(res => console.log(res));

    });


</script>


</body>
</html>